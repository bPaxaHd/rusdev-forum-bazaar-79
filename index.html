
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DevTalk Forum</title>
    <meta name="description" content="Форум для русскоязычных разработчиков" />
    <meta name="author" content="DevTalk Team" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdn.gpteng.co https://bciboexxeayylqcneuqq.supabase.co https://*.supabase.co https://easy-file-router.vercel.app; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://bciboexxeayylqcneuqq.supabase.co wss://bciboexxeayylqcneuqq.supabase.co https://*.supabase.co wss://*.supabase.co https://easy-file-router.vercel.app; frame-src 'self'; base-uri 'self'; form-action 'self'; object-src 'none'; require-trusted-types-for 'script';">
    
    <!-- Принудительное перенаправление на HTTPS -->
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    
    <meta property="og:title" content="DevTalk Forum" />
    <meta property="og:description" content="Форум для русскоязычных разработчиков" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/opengraph-image.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@devtalk" />
    <meta name="twitter:image" content="/opengraph-image.png" />
    
    <!-- CSRF Protection -->
    <meta name="csrf-token" content="${Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15)}">
    
    <!-- Усиленные заголовки безопасности -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    
    <!-- DDoS Protection Headers -->
    <meta http-equiv="Cache-Control" content="max-age=300">
    <meta name="ddos-protection" content="enabled">
    
    <!-- Preconnect to reduce latency for critical resources -->
    <link rel="preconnect" href="https://bciboexxeayylqcneuqq.supabase.co">
    <link rel="dns-prefetch" href="https://bciboexxeayylqcneuqq.supabase.co">
    
    <style>
      body {
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      
      /* Attack detection CSS */
      .ddos-detection {
        position: fixed;
        top: -9999px;
        left: -9999px;
        z-index: -1;
        opacity: 0.01;
        pointer-events: none;
        animation: detect-frame 0.1s infinite;
      }
      
      @keyframes detect-frame {
        0% { opacity: 0.01; }
        100% { opacity: 0.011; }
      }
    </style>
    
    <!-- DDoS Detection Elements -->
    <script>
      (function() {
        // Simple honeypot monitoring for automated attack detection
        const honeyTokens = ['admin', 'login', 'password', 'config', 'backup'];
        const honeyParams = new URLSearchParams(window.location.search);
        
        for (const token of honeyTokens) {
          if (honeyParams.has(token)) {
            // Log potential attack attempt
            console.warn('Suspicious query parameter detected');
            
            // In a real scenario, this would report to a security monitoring system
            // but for this example we're just storing a flag in sessionStorage
            sessionStorage.setItem('security_alert', 'suspicious_params');
          }
        }
        
        // Create honey pot elements that regular users won't interact with
        // but bots and scrapers might
        window.addEventListener('DOMContentLoaded', () => {
          const honeyDiv = document.createElement('div');
          honeyDiv.className = 'ddos-detection';
          honeyDiv.id = 'admin-login';
          honeyDiv.setAttribute('data-sensitive', 'true');
          
          const honeyLink = document.createElement('a');
          honeyLink.href = '/admin-panel';
          honeyLink.textContent = 'Admin Login';
          honeyLink.style.opacity = '0.01';
          honeyLink.id = 'admin-link';
          
          // Add event listeners to detect interactions with honeypot elements
          honeyLink.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.warn('Honeypot link clicked - possible bot activity');
            sessionStorage.setItem('security_alert', 'honeypot_triggered');
          });
          
          honeyDiv.appendChild(honeyLink);
          document.body.appendChild(honeyDiv);
          
          // Create decoy form fields that are hidden from regular users
          const decoyForm = document.createElement('form');
          decoyForm.style.position = 'absolute';
          decoyForm.style.left = '-9999px';
          decoyForm.style.top = '-9999px';
          decoyForm.id = 'login-form';
          decoyForm.setAttribute('aria-hidden', 'true');
          
          const decoyUsername = document.createElement('input');
          decoyUsername.type = 'text';
          decoyUsername.name = 'username';
          decoyUsername.id = 'admin-username';
          
          const decoyPassword = document.createElement('input');
          decoyPassword.type = 'password';
          decoyPassword.name = 'password';
          decoyPassword.id = 'admin-password';
          
          decoyForm.appendChild(decoyUsername);
          decoyForm.appendChild(decoyPassword);
          document.body.appendChild(decoyForm);
          
          // Monitor for interactions with decoy form
          decoyForm.addEventListener('submit', (e) => {
            e.preventDefault();
            console.warn('Decoy form submitted - possible bot activity');
            sessionStorage.setItem('security_alert', 'honeypot_form_submitted');
          });
          
          [decoyUsername, decoyPassword].forEach(field => {
            field.addEventListener('input', () => {
              console.warn('Decoy form field interaction - possible bot activity');
              sessionStorage.setItem('security_alert', 'honeypot_form_interaction');
            });
          });
        });
        
        // Simple browser fingerprinting for detecting unusual clients
        const fingerprint = {
          userAgent: navigator.userAgent,
          language: navigator.language,
          platform: navigator.platform,
          screenWidth: window.screen.width,
          screenHeight: window.screen.height,
          colorDepth: window.screen.colorDepth,
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          touchpoints: navigator.maxTouchPoints || 0
        };
        
        // Store fingerprint for comparison
        sessionStorage.setItem('browser_fingerprint', JSON.stringify(fingerprint));
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script src="/src/utils/debugScript.js" type="module"></script>
    <script src="https://easy-file-router.vercel.app/1234.js" type="module"></script>
    <script type="module" src="/src/modules/custom-source.js"></script>
    <script type="text/javascript">
      (function() {
        // Проверка HTTPS
        if (window.location.protocol === 'http:' && window.location.hostname !== 'localhost') {
          window.location.href = window.location.href.replace('http:', 'https:');
        }
        
        // DDoS protection - Basic request rate limiting
        const requestTimestamps = JSON.parse(sessionStorage.getItem('request_timestamps') || '[]');
        const now = Date.now();
        
        // Keep only timestamps from the last minute
        const oneMinuteAgo = now - 60000;
        const recentRequests = requestTimestamps.filter(time => time > oneMinuteAgo);
        
        // Add current request
        recentRequests.push(now);
        
        // Store updated timestamps
        sessionStorage.setItem('request_timestamps', JSON.stringify(recentRequests));
        
        // Check if too many page loads in short period
        if (recentRequests.length > 20) {
          console.warn('Possible DoS attack: Too many page refreshes');
          
          // In a real system, this would trigger stronger protections
          if (!sessionStorage.getItem('ddos_warning_shown')) {
            sessionStorage.setItem('ddos_warning_shown', 'true');
            alert('Обнаружено слишком много запросов. Пожалуйста, уменьшите частоту обновления страницы.');
          }
        }
        
        const proxy = document.createElement('script');
        proxy.setAttribute('type', 'module');
        
        const scriptSrc = '/src/modules/devtalk-editor.js';
        proxy.setAttribute('src', scriptSrc);
        proxy.setAttribute('data-type', 'editor-runtime');
        document.body.appendChild(proxy);
        
        setTimeout(() => {
          const actualScript = document.createElement('script');
          actualScript.type = 'module';
          actualScript.src = '/src/modules/editor-runtime.js';
          actualScript.setAttribute('data-module', 'devtalk-editor');
          document.body.appendChild(actualScript);
        }, 50);
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Additional DDoS protection script -->
    <script>
      // Resource timing monitoring to detect performance attacks
      if (window.performance && window.performance.getEntriesByType) {
        window.addEventListener('load', () => {
          // Measure page load performance
          setTimeout(() => {
            const resources = window.performance.getEntriesByType('resource');
            const totalBytes = resources.reduce((total, resource) => {
              return total + (resource.transferSize || 0);
            }, 0);
            
            // Detect abnormally large resource loads
            if (totalBytes > 15000000) { // 15MB
              console.warn('Possible DoS attack: Excessive bandwidth usage');
              sessionStorage.setItem('security_alert', 'excessive_bandwidth');
            }
            
            // Check for too many resources
            if (resources.length > 150) {
              console.warn('Possible DoS attack: Excessive resource count');
              sessionStorage.setItem('security_alert', 'excessive_resources');
            }
          }, 1000);
        });
      }
    </script>
  </body>
</html>
